name: Deploy to Azure Container App
on:
  workflow_run:
    workflows: ["Build and push Docker image to Docker Hub"]
    types:
      - completed

jobs:
  deploy-to-azure:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: |
            {
              "clientId": "${{ secrets.AZURE_CLIENT_ID }}",
              "clientSecret": "${{ secrets.AZURE_CLIENT_SECRET }}",
              "tenantId": "${{ secrets.AZURE_TENANT_ID }}",
              "subscriptionId": "${{ secrets.AZURE_SUBSCRIPTION_ID }}"
            }

    - name: Pull Docker image from Docker Hub
      run: docker pull bujanovakatia/ld-questions:latest

    - name: Update Azure Container App with new image
      run: az container update --resource-group LD_rg --name container-app --image bujanovakatia/ld-questions:latest
